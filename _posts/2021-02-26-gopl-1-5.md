---
layout: post
title: "The Go Programming Language #1.5: URL 반입"
subtitle: "The Go Programming Language 책 내용 정리"
author: "karais89"
header-img: "img/post-bg-golang.jpg"
header-mask: 0.4
catalog: true
tags: [gopl, golang]
---

> The Go Programming Language 책 내용 정리

## 1.5 URL 반입

Go는 net 그룹의 하위 패키지로 인터넷을 통해 정보를 주고받고 저수준 네트워크 연결을 생성하고, 서버를 설정하기 쉽게 하는 패키지들을 제공한다. 이는 Go의 동시성에 특히 유용한 부분이다.

### fetch

```go
package main

import (
	"fmt"
	"io/ioutil"
	"net/http"
	"os"
)

func main() {
	for _, url := range os.Args[1:] {
		resp, err := http.Get(url)
		if err != nil {
			fmt.Fprintf(os.Stderr, "fetch: %v\n", err)
			os.Exit(1)
		}
		b, err := ioutil.ReadAll(resp.Body)
		resp.Body.Close()
		if err != nil {
			fmt.Fprintf(os.Stderr, "fetch: reading %s: %v\n", url, err)
			os.Exit(1)
		}
		fmt.Printf("%s", b)
	}
}
```

- url에서 내용을 가져오고 원본 그대로 출력하는 예제
- net/http와 io/ioutil의 함수 사용
- ReadAll은 전체 응답을 읽는다. http.get으로 받은 body는 위와 같은 형태로 읽는다고 생각하면 됨.

### exam1-7

```go
package main

import (
	"fmt"
	"io"
	"net/http"
	"os"
)

func main() {
	for _, url := range os.Args[1:] {
		resp, err := http.Get(url)
		if err != nil {
			fmt.Fprintf(os.Stderr, "fetch: %v\n", err)
			os.Exit(1)
		}
		_, err = io.Copy(os.Stdout, resp.Body)
		resp.Body.Close()
		if err != nil {
			fmt.Fprintf(os.Stderr, "fetch: reading %s: %v\n", url, err)
			os.Exit(1)
		}
	}
}
```

- io.copy(dst, src) 함수를 ioutil.ReadAll 대신 사용. os.Stdout로 복사 후 에러 확인
    - 에러는 발생하지 않음 원래는 버퍼 문제등으로 에러가 발생하는 것 같은데 버퍼가 크나?

### exam1-8

```go
package main

func main() {
	for _, url := range os.Args[1:] {
		if !strings.HasPrefix(url, "http://") {
			url = "http://" + url
		}
		
		// .. 아래 코드는 fetch와 동일		
	}
}
```

- http:// 접두사가 누락된 경우도 정상적으로 동작 가능하게 변경
- HasPrefix로 접두사 검사 후 없으면 추가 하는 방식

### exam1-9

```go
package main

func main() {
	for _, url := range os.Args[1:] {
		// .. fetch와 동일
		fmt.Printf("status Code: %d\n", resp.StatusCode)
		fmt.Printf("%s", b)
	}
}
```

- fetch를 수정해 resp.Status에 있는 HTTP 응답 코드도 같이 출력